#!/usr/bin/php
<?php

namespace Monolyth\Cliff;

use Throwable;

if (!file_exists(getcwd().'/vendor/autoload.php')) {
    fwrite(STDERR, <<<EOT
vendor/autoload.php not found; did you run `composer install`?

EOT
    );
    die(9);
}

require_once getcwd().'/vendor/autoload.php';

$arg = $argv;
// This is the executable's name, we don't care about that.
array_shift($arg);
$command = Command::toPhpName(array_shift($arg));
try {
    $cliff = new $command;
    $cliff(...array_filter($arg, function ($entry) {
        return $entry{0} != '-';
    }));
} catch (Throwable $e) {
    fwrite(STDERR, sprintf(
        <<<EOT
Oops! We seem to have jumped off a cliff, whilst shouting:
"%s"

This happened in file %s on line %d.


EOT
        ,
        $e->getMessage(),
        $e->getFile(),
        $e->getLine()
    ));
    exit($e->getCode());
}

